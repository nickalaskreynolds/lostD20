function diceRollerama(){function a(a){return document.querySelector(a)}function b(a){return document.querySelectorAll(a)}function c(a,b){a.classList.toggle(b)}function d(a,b){a.classList.add(b)}function e(a,b){a.classList.remove(b)}function f(a,b){for(var c=a[b],d=0;d<c.length;d++)c[d].checked&&(A=c[d].value);return A}function g(a,b){for(var c=a[b],d=0;d<c.length;d++)c[d].checked?K[d].classList.add("active"):K[d].classList.remove("active")}function h(){f(E,"diceSelect"),r(),q();var a=["Aieee!","Aiieee!","Arrgh!","Awk!","Awkkkkkk!","Bam!","Bang!","Bang!","Biff!","Bloop!","Blurp!","Boff!","Bonk!","Clank!","Clank!","Clash!","Clunk!","Clunk!","Crraack!","Crash!","Crraack!","Crunch!","Crunch!","Eee-yow!","Flrbbbbb!","Glipp!","Glurpp!","Kapow!","Kayo!","Ker-sploosh!","Kerplop!","Klonk!","Klunk!","Krunch!","Oooff!","Ooooff!","Ouch!","Ouch!","Owww!","Ow","Pam!","Plop!","Pow!","Powie!","Qunckkk!","Rakkk!","Rip!","Slosh!","Sock!","Splats!","Splatt!","Sploosh!","Swaap!","Swish!","Swoosh!","Thunk!","Thwack!","Thwacke!","Thwape!","Thwapp!","Uggh!","Urkkk!","Vronk!","Whack!","Whack!","Wham!","Whamm!","Whammm!","Whap!","Z-zwap!","Zam!","Zamm!","Zammm!","Zap!","Zap","Zgruppp!","Zlonk!","Zlopp!","Zlott!","Zok!","Zowie!","Zwapp!","Zzwap!","Zzzzwap!","Zzzzzwap!","Pepper-Pow!"],b=a[Math.floor(Math.random()*a.length)],c=function(){c=B>0?"+"+B:0>B?B:""},d=function(){d=1==C?" hidden":""},e=function(){c(),d(),G.innerHTML='<p class="savedFormula"><span class="icon-bookmark"></span><input class="name" type="text" placeholder="The roll with no name" value="'+b+'"><a href="javascript:void(0)" class="button button-primary roll">Roll</a> <span class="amountOfDice'+d+'">'+C+'</span> <span class="dice"><span class="diceIcon-d'+A+'" data-dice-sides="'+A+'"></span></span> <span class="amountOfBonus">'+c+'</span><a href="javascript:void(0)" class="button button-secondary clear"><span class="icon-close"></span></a><span class="deleteConfirm">Delete this roll?<a href="javascript:void(0)" class="button button-secondary cancel">Keep</a><a href="javascript:void(0)" class="button button-primary delete">Delete</a></span></p>'+G.innerHTML};e(),z(),u()}function i(){var a=event.keyCode||event.which;13==a&&this.blur()}function j(a){a.setAttribute("value",a.value)}function k(a){var b=ba(a,".savedFormula");d(b,"showDelete")}function l(a){var b=ba(a,".savedFormula");b.parentNode.removeChild(b)}function m(a){var b=ba(a,".savedFormula");e(b,"showDelete")}function n(b){var c=parseInt(b.parentNode.querySelector(".amountOfDice").textContent,10)||0,d=b.parentNode.querySelector(".dice span"),e=parseInt(d.dataset.diceSides,10)||0,f=parseInt(b.parentNode.querySelector(".amountOfBonus").textContent,10)||0,h=b.parentNode.querySelector(".name").value;a("#d"+e).checked=!0,1>=c?M.value="":M.value=c,0==f?L.value="":f>0?L.value="+"+f:L.value=f,r(),q(),g(E,"diceSelect"),o(c,e,f,h)}function o(a,b,c,d){for(var e=[],f=0;a>f;f++)e.push(Math.floor(Math.random()*b)+1);var g,h=function(a){g=0;for(var b=0;b<a.length;b++)a[b]<a[g]&&(g=b);return g};h(e);var i,j=e.reduce(function(a,b){return a+b}),k=X.dataset.active;"true"==k&&a>1?(i=e[g],e[g]='<span class="strike">'+e[g]+"</span>"):i=0;var l,m=j+c-i,n=e.join(", ");l=c>0?"+":"";var o;o=0==c?"":" ("+l+c+" Bonus)";var p;p=d?d+" = ":"";var q;q=20==b&&1==a?20==j?" critical-20":1==j?" critical-1":"":"",H.innerHTML='<p class="u-cf'+q+'"><span class="total">'+m+'</span> <span class="breakdown">'+p+a+' <span class="dice"><span class="diceIcon-d'+b+'"></span></span> <span class="multipleDiceResults">(Rolled: '+n+")</span>"+o+"</span></p>"+H.innerHTML,u()}function p(){H.innerHTML="",s(0,L),r(),s(0,M),q(),u()}function q(){return C=parseInt(M.value,10)||0,M.value<=0||""==M.value?(C=1,M.value=""):M.value>=999&&(M.value="999"),0==M.value||""==M.value?d(S,"hide"):e(S,"hide"),C}function r(){return B=parseInt(L.value,10)||0,0==B||""==L.value?L.value="":B>0&&(L.value="+"+B),B>=999&&(L.value="+999"),0==B||""==B?d(N,"hide"):e(N,"hide"),B}function s(a,b){b.value=1*b.value+a,("0"==b.value||0==a||"NaN"==b.value)&&(b.value="")}function t(){var a=window.document,b=a.documentElement,d=b.requestFullscreen||b.mozRequestFullScreen||b.webkitRequestFullScreen||b.msRequestFullscreen,e=a.exitFullscreen||a.mozCancelFullScreen||a.webkitExitFullscreen||a.msExitFullscreen;a.fullscreenElement||a.mozFullScreenElement||a.webkitFullscreenElement||a.msFullscreenElement?(e.call(a),c($,"active"),c(_,"icon-fullscreen-exit"),c(_,"icon-fullscreen")):(d.call(b),c($,"active"),c(_,"icon-fullscreen-exit"),c(_,"icon-fullscreen"))}function u(){H.firstChild?D.classList.add("active"):D.classList.remove("active")}function v(a,b){localStorage.getItem&&localStorage.setItem(a,b.innerHTML)}function w(a,b){""==localStorage.getItem(a)?localStorage.removeItem(a):localStorage.getItem(a)&&(b.innerHTML=localStorage.getItem(a))}function x(){c(X,"active"),c(Y,"icon-arrow-drop-down"),c(Y,"icon-arrow-drop-down-circle");var a=X.dataset.active;"false"==a?X.dataset.active="true":"true"==a&&(X.dataset.active="false")}function y(){for(var a=0;a<K.length;a++)K[a].addEventListener("click",function(){g(E,"diceSelect")},!1)}function z(){for(var a=b(".savedFormula"),c=b(".savedFormula .roll"),d=b(".savedFormula .clear"),e=b(".savedFormula .delete"),f=b(".savedFormula .cancel"),g=b(".savedFormula .name"),h=(b(".savedFormula .deleteConfirm"),0);h<a.length;h++)c[h].addEventListener("click",function(){n(this),v("savedHistory",H)},!1);for(var h=0;h<a.length;h++)d[h].addEventListener("click",function(){k(this),v("savedHistory",H)},!1);for(var h=0;h<a.length;h++)e[h].addEventListener("click",function(){l(this),v("savedRolls",G)},!1);for(var h=0;h<a.length;h++)f[h].addEventListener("click",function(){m(this),v("savedHistory",H)},!1);for(var h=0;h<a.length;h++)g[h].addEventListener("click",function(){this.select()}),g[h].addEventListener("keyup",function(){j(this),v("savedRolls",G)},!1),g[h].addEventListener("keyup",i,!1)}var A,B,C,D=(a("html"),a(".column-third.controls"),a(".column-third.results")),E=(a(".column-third.formulas"),a(".diceSelector")),F=a(".goRoll"),G=(a(".savedRolls"),a(".savedRolls .list")),H=(a(".resultHistory"),a(".resultHistory .list")),I=a(".results .toggleFullscreen"),J=a(".results .toggleFullscreen span"),K=b(".diceSelector label"),L=(a(".formula .number.ofBonus"),a(".formula .number.ofBonus input")),M=(a(".formula .number.ofDice"),a(".formula .number.ofDice input")),N=a(".formula .number.ofBonus .clear"),O=a(".modifiers .changeAmount.ofBonus .plusFive"),P=a(".modifiers .changeAmount.ofBonus .plusOne"),Q=a(".modifiers .changeAmount.ofBonus .minusFive"),R=a(".modifiers .changeAmount.ofBonus .minusOne"),S=a(".formula .number.ofDice .clear"),T=a(".modifiers .changeAmount.ofDice .plusFive"),U=a(".modifiers .changeAmount.ofDice .plusOne"),V=a(".modifiers .changeAmount.ofDice .minusFive"),W=a(".modifiers .changeAmount.ofDice .minusOne"),X=a(".utilities .toggleDropLowest"),Y=a(".utilities .toggleDropLowest span"),Z=a(".utilities .saveCurrentFormula"),$=a(".utilities .toggleFullscreen"),_=a(".utilities .toggleFullscreen span"),aa=a(".utilities .clearAll"),ba=function(a,b){for(var c=b.charAt(0);a&&a!==document;a=a.parentNode){if("."===c&&a.classList.contains(b.substr(1)))return a;if("#"===c&&a.id===b.substr(1))return a;if("["===c&&a.hasAttribute(b.substr(1,b.length-2)))return a;if(a.tagName.toLowerCase()===b)return a}return!1};F.addEventListener("click",function(){o(q(),f(E,"diceSelect"),r()),v("savedHistory",H)},!1),X.addEventListener("click",function(){x()},!1),aa.addEventListener("click",function(){p(),v("savedHistory",H)},!1),Z.addEventListener("click",function(){h(),v("savedRolls",G)},!1),$.addEventListener("click",function(){t()},!1),N.addEventListener("click",function(){s(0,L),r()},!1),S.addEventListener("click",function(){s(0,M),q()},!1),L.addEventListener("input",function(){r()},!1),L.addEventListener("keyup",i,!1),L.addEventListener("click",function(){this.select()},!1),O.addEventListener("click",function(){s(5,L),r()},!1),P.addEventListener("click",function(){s(1,L),r()},!1),R.addEventListener("click",function(){s(-1,L),r()},!1),Q.addEventListener("click",function(){s(-5,L),r()},!1),M.addEventListener("input",function(){q()},!1),M.addEventListener("keyup",i,!1),M.addEventListener("click",function(){this.select()},!1),T.addEventListener("click",function(){s(5,M),q()},!1),U.addEventListener("click",function(){s(1,M),q()},!1),W.addEventListener("click",function(){s(-1,M),q()},!1),V.addEventListener("click",function(){s(-5,M),q()},!1),I.addEventListener("click",function(){c(D,"fullsize"),c(I,"active"),c(J,"icon-unfold-more"),c(J,"icon-unfold-less")},!1),r(),q(),y(),f(E,"diceSelect"),g(E,"diceSelect"),w("savedRolls",G),w("savedHistory",H),z(),u()}diceRollerama();