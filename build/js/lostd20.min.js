function diceRollerama(){function a(a){return document.querySelector(a)}function b(a){return document.querySelectorAll(a)}function c(a,b){a.classList.toggle(b)}function d(a,b){a.classList.add(b)}function e(a,b){a.classList.remove(b)}function f(a,b){for(var c=a[b],d=0;d<c.length;d++)c[d].checked&&(E=c[d].value);return E}function g(a,b){for(var c=a[b],d=0;d<c.length;d++)c[d].checked?K[d].classList.add("active"):K[d].classList.remove("active")}function h(){var a=event.keyCode||event.which;13==a&&this.blur()}function i(a){a.setAttribute("value",a.value);var b=da(a,".saved-formula");b.dataset.rollName=a.value}function j(a,b,c,d){for(var e=[],f=0;a>f;f++)e.push(Math.floor(Math.random()*b)+1);var g,h=function(a){g=0;for(var b=0;b<a.length;b++)a[b]<a[g]&&(g=b);return g};h(e);var i,j=e.reduce(function(a,b){return a+b}),k=Y.dataset.active;"true"==k&&a>1?(i=e[g],e[g]='<span class="strike">'+e[g]+"</span>"):i=0;var l,m=j+c-i,n=e.join(", ");l=c>0?"+":"";var o;o=0==c?"":" ("+l+c+" Bonus)";var p;p=d?d+" = ":"";var q;q=20==b&&1==a?20==j?" critical-20":1==j?" critical-1":"":"",N.innerHTML='<p class="cf'+q+'"><span class="total">'+m+'</span> <span class="breakdown">'+p+a+' <span class="dice"><span class="diceIcon-d'+b+'"></span></span> <span class="multiple-dice-results">(Rolled: '+n+")</span>"+o+"</span></p>"+N.innerHTML,v()}function k(a,b,c,d){var e=["Aieee!","Aiieee!","Arrgh!","Awk!","Awkkkkkk!","Bam!","Bang!","Bang!","Biff!","Bloop!","Blurp!","Boff!","Bonk!","Clank!","Clank!","Clash!","Clunk!","Clunk!","Crraack!","Crash!","Crraack!","Crunch!","Crunch!","Eee-yow!","Flrbbbbb!","Glipp!","Glurpp!","Kapow!","Kayo!","Ker-sploosh!","Kerplop!","Klonk!","Klunk!","Krunch!","Oooff!","Ooooff!","Ouch!","Ouch!","Owww!","Ow","Pam!","Plop!","Pow!","Powie!","Qunckkk!","Rakkk!","Rip!","Slosh!","Sock!","Splats!","Splatt!","Sploosh!","Swaap!","Swish!","Swoosh!","Thunk!","Thwack!","Thwacke!","Thwape!","Thwapp!","Uggh!","Urkkk!","Vronk!","Whack!","Whack!","Wham!","Whamm!","Whammm!","Whap!","Z-zwap!","Zam!","Zamm!","Zammm!","Zap!","Zap","Zgruppp!","Zlonk!","Zlopp!","Zlott!","Zok!","Zowie!","Zwapp!","Zzwap!","Zzzzwap!","Zzzzzwap!","Pepper-Pow!"],f=function(){f=d?d:e[Math.floor(Math.random()*e.length)]},g=function(){g=F>0?"+"+F:0>F?F:""},h=function(){h=1==G?" hidden":""},i=function(){g(),h(),f(),M.innerHTML='<div class="saved-formula" data-roll-name="'+f+'" data-ammount-of-dice="'+G+'" data-dice="'+E+'" data-ammount-of-bonus="'+F+'"><div class="row"><div class="col-12"><div class="name"><input class="dark" type="text" placeholder="Who am I?" value="'+f+'" tabindex="1"></div><div class="row"><div class="col-4"><div class="formula-record"><span class="amount-of-dice'+h+'">'+G+'</span> <span class="which-dice">d'+E+'</span> <span class="amount-of-bonus">'+g+'</span></div></div><div class="col-8"><div class="formula-controls"><a href="javascript:void(0)" class="button button-dark button-small move-up" tabindex="1"><span class="icon-expand-less"></span></a><a href="javascript:void(0)" class="button button-dark button-small move-down" tabindex="1"><span class="icon-expand-more"></span></a><a href="javascript:void(0)" class="button button-dark button-small clear" tabindex="1"><span class="icon-close"></span></a><a href="javascript:void(0)" class="button button-dark button-small roll" tabindex="1">Roll</a></div></div></div></div></div></div>'+M.innerHTML};i(),D()}function l(b){var c=da(b,".saved-formula"),d=c.dataset.rollName,e=parseInt(c.dataset.ammountOfDice,10),f=parseInt(c.dataset.dice,10),h=parseInt(c.dataset.ammountOfBonus,10);a("#d"+f).checked=!0,1>=e?S.value="":S.value=e,0==h?Q.value="":h>0?Q.value="+"+h:Q.value=h,s(),r(),g(J,"dice-select"),j(e,f,h,d)}function m(b){var c=da(b,".saved-formula"),e=c.dataset.rollName,f=parseInt(c.dataset.ammountOfDice,10),g=parseInt(c.dataset.dice,10),h=parseInt(c.dataset.ammountOfBonus,10);c.remove(),w("saved-formulas",M);var i=Date.now(),j='<div id="snack-'+i+'" class="snack-bar" data-roll-name="'+e+'" data-ammount-of-dice="'+f+'" data-dice="'+g+'" data-ammount-of-bonus="'+h+'"><div class="row"><div class="col-6"><p class="message">'+e+' removed.</p></div><div class="col-6"><a href="javascript:void(0)" class="button button-dark button-small clear"><span class="icon-close"></span></a><a href="javascript:void(0)" class="button button-dark button-small undo">Undo</a></div></div></div>';ca.innerHTML=ca.innerHTML+j;var k=a("#snack-"+i),l=function(){d(k,"reveal")};p(l,10),C();var m=function(){snackBarToClear=a("#snack-"+i),snackBarToClear&&n(snackBarToClear)};p(m,6e3),k.addEventListener("mouseover",function(){clearTimeout(p),console.log("hover")},!1)}function n(a){var b=da(a,".snack-bar"),c=function(){e(b,"reveal")};p(c,10);var d=function(){b.remove()};p(d,500)}function o(a){var b=da(a,".snack-bar"),c=b.dataset.rollName,d=parseInt(b.dataset.ammountOfDice,10),e=parseInt(b.dataset.dice,10),f=parseInt(b.dataset.ammountOfBonus,10);k(d,e,f,c),n(a)}function p(a,b){window.setTimeout(a,b)}function q(){N.innerHTML="",v(),e(H,"active"),e(H,"fullsize")}function r(){return G=parseInt(S.value,10)||0,S.value<=0||""==S.value?(G=1,S.value=""):S.value>=999&&(S.value="999"),0==S.value||""==S.value?d(T,"hide"):e(T,"hide"),G}function s(){return F=parseInt(Q.value,10)||0,0==F||""==Q.value?Q.value="":F>0&&(Q.value="+"+F),F>=999&&(Q.value="+999"),0==F||""==F?d(R,"hide"):e(R,"hide"),F}function t(a,b){b.value=1*b.value+a,("0"==b.value||0==a||"NaN"==b.value)&&(b.value="")}function u(){var a=window.document,b=a.documentElement,d=b.requestFullscreen||b.mozRequestFullScreen||b.webkitRequestFullScreen||b.msRequestFullscreen,e=a.exitFullscreen||a.mozCancelFullScreen||a.webkitExitFullscreen||a.msExitFullscreen;a.fullscreenElement||a.mozFullScreenElement||a.webkitFullscreenElement||a.msFullscreenElement?(e.call(a),c(_,"active"),c(aa,"icon-fullscreen-exit"),c(aa,"icon-fullscreen")):(d.call(b),c(_,"active"),c(aa,"icon-fullscreen-exit"),c(aa,"icon-fullscreen"))}function v(){M.firstChild?I.classList.add("active"):I.classList.remove("active"),N.firstChild?H.classList.add("active"):H.classList.remove("active")}function w(a,b){localStorage.getItem&&localStorage.setItem(a,b.innerHTML)}function x(a,b){""==localStorage.getItem(a)?localStorage.removeItem(a):localStorage.getItem(a)&&(b.innerHTML=localStorage.getItem(a))}function y(){c(Y,"active"),c(Z,"icon-check-box"),c(Z,"icon-check-box-outline-blank");var a=Y.dataset.active;"false"==a?Y.dataset.active="true":"true"==a&&(Y.dataset.active="false")}function z(a){var b=event.keyCode||event.which;38==b||39==b?1==event.shiftKey?t(5,a):t(1,a):(40==b||37==b)&&(1==event.shiftKey?t(-5,a):t(-1,a))}function A(a){var b=da(a,".saved-formula"),c=da(a,".list");if(a.classList.contains("move-up")){var f=b.previousSibling;d(b,"moving-up"),d(b.previousSibling,"moving-down");var g=function(){e(b.previousSibling,"moving-down"),e(b,"moving-up"),c.insertBefore(b,f),w("saved-formulas",M)};p(g,500)}else if(a.classList.contains("move-down")){var h=b.nextSibling.nextSibling;d(b.nextSibling,"moving-up"),d(b,"moving-down");var g=function(){e(b.nextSibling,"moving-up"),e(b,"moving-down"),c.insertBefore(b,h),w("saved-formulas",M)};p(g,500)}}function B(){for(var a=0;a<K.length;a++)K[a].addEventListener("click",function(){g(J,"dice-select")},!1)}function C(){for(var a=b(".snack-bar"),c=b(".snack-bar .clear"),d=b(".snack-bar .undo"),e=0;e<a.length;e++)c[e].addEventListener("click",function(){n(this)},!1);for(var e=0;e<a.length;e++)d[e].addEventListener("click",function(){o(this),w("saved-formulas",M),v()},!1)}function D(){for(var a=b(".saved-formula"),c=b(".saved-formula .roll"),d=b(".saved-formula .move-up"),e=b(".saved-formula .move-down"),f=b(".saved-formula .clear"),g=b(".saved-formula .name input"),j=0;j<a.length;j++)c[j].addEventListener("click",function(){l(this),w("saved-history",N)},!1);for(var j=0;j<a.length;j++)d[j].addEventListener("click",function(){A(this),w("saved-formulas",M)},!1);for(var j=0;j<a.length;j++)e[j].addEventListener("click",function(){A(this),w("saved-formulas",M)},!1);for(var j=0;j<a.length;j++)f[j].addEventListener("click",function(){m(this),w("saved-formulas",M),v()},!1);for(var j=0;j<a.length;j++)g[j].addEventListener("click",function(){this.select()}),g[j].addEventListener("input",function(){i(this),w("saved-formulas",M)},!1),g[j].addEventListener("keypress",h,!1)}var E,F,G,H=(a("html"),a(".main-column.controls"),a(".main-column.results")),I=a(".main-column.formulas"),J=a(".dice-form"),K=b(".dice-form label"),L=a(".go-roll"),M=a(".formulas .list"),N=a(".results .list"),O=a(".results .toggle-fullscreen"),P=a(".results .toggle-fullscreen span"),Q=(a(".controls .number.of-bonus"),a(".controls .number.of-bonus input")),R=a(".controls .number.of-bonus .clear"),S=(a(".controls .number.of-dice"),a(".controls .number.of-dice input")),T=a(".controls .number.of-dice .clear"),U=a(".modifiers .change-amount.of-bonus .plus-one"),V=a(".modifiers .change-amount.of-bonus .minus-one"),W=a(".modifiers .change-amount.of-dice .plus-one"),X=a(".modifiers .change-amount.of-dice .minus-one"),Y=a(".utilities .toggle-drop-lowest"),Z=a(".utilities .toggle-drop-lowest span"),$=a(".utilities .save-current-formula"),_=a(".utilities .toggle-fullscreen"),aa=a(".utilities .toggle-fullscreen span"),ba=a(".utilities .clear-all"),ca=a(".snacks"),da=function(a,b){for(var c=b.charAt(0);a&&a!==document;a=a.parentNode){if("."===c&&a.classList.contains(b.substr(1)))return a;if("#"===c&&a.id===b.substr(1))return a;if("["===c&&a.hasAttribute(b.substr(1,b.length-2)))return a;if(a.tagName.toLowerCase()===b)return a}return!1};L.addEventListener("click",function(){j(r(),f(J,"dice-select"),s()),w("saved-history",N)},!1),Y.addEventListener("click",function(){y()},!1),ba.addEventListener("click",function(){q(),w("saved-history",N)},!1),$.addEventListener("click",function(){k(r(),f(J,"dice-select"),s()),w("saved-formulas",M),v()},!1),_.addEventListener("click",function(){u()},!1),R.addEventListener("click",function(){t(0,Q),s()},!1),T.addEventListener("click",function(){t(0,S),r()},!1),Q.addEventListener("input",function(){s()},!1),Q.addEventListener("keypress",h,!1),Q.addEventListener("keydown",function(){z(Q),s()},!1),Q.addEventListener("click",function(){this.select()},!1),U.addEventListener("click",function(){t(1,Q),s()},!1),V.addEventListener("click",function(){t(-1,Q),s()},!1),S.addEventListener("input",function(){r()},!1),S.addEventListener("keypress",h,!1),S.addEventListener("keydown",function(){z(S),r()},!1),S.addEventListener("click",function(){this.select()},!1),W.addEventListener("click",function(){t(1,S),r()},!1),X.addEventListener("click",function(){t(-1,S),r()},!1),O.addEventListener("click",function(){c(H,"fullsize"),c(O,"active"),c(P,"icon-unfold-more"),c(P,"icon-unfold-less")},!1),s(),r(),B(),f(J,"dice-select"),g(J,"dice-select"),x("saved-formulas",M),x("saved-history",N),D(),v()}diceRollerama();