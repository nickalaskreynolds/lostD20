function diceRollerama(){function a(a){return document.querySelector(a)}function b(a){return document.querySelectorAll(a)}function c(a,b){a.classList.toggle(b)}function d(a,b){a.classList.add(b)}function e(a,b){a.classList.remove(b)}function f(a,b){window.setTimeout(a,b)}function g(a,b){localStorage.getItem&&localStorage.setItem(a,b.innerHTML)}function h(a,b){""==localStorage.getItem(a)?localStorage.removeItem(a):localStorage.getItem(a)&&(b.innerHTML=localStorage.getItem(a))}function i(){var a=pa.querySelector("span"),b=window.document,d=b.documentElement,e=d.requestFullscreen||d.mozRequestFullScreen||d.webkitRequestFullScreen||d.msRequestFullscreen,f=b.exitFullscreen||b.mozCancelFullScreen||b.webkitExitFullscreen||b.msExitFullscreen;b.fullscreenElement||b.mozFullScreenElement||b.webkitFullscreenElement||b.msFullscreenElement?(f.call(b),c(pa,"active"),c(a,"icon-fullscreen-exit"),c(a,"icon-fullscreen")):(e.call(d),c(pa,"active"),c(a,"icon-fullscreen-exit"),c(a,"icon-fullscreen"))}function j(){var a=oa.querySelector("span");c(oa,"active"),c(a,"icon-check-box-checked"),c(a,"icon-check-box-unchecked");var b=oa.dataset.active;"false"==b?oa.dataset.active="true":"true"==b&&(oa.dataset.active="false")}function k(a,b){for(var c=a[b],d=0;d<c.length;d++)c[d].checked&&(P=c[d].value);return P}function l(a,b){for(var c=a[b],d=0;d<c.length;d++)if(c[d].checked){X[d].classList.add("active");var e=parseInt(X[d].querySelector("input").value,10);Z.textContent=e}else X[d].classList.remove("active")}function m(){for(var a=0;a<X.length;a++)X[a].addEventListener("click",function(){l(W,"dice-select")},!1)}function n(a){var b=event.keyCode||event.which;13==b&&a.blur()}function o(a){var b=event.keyCode||event.which;38==b?v(1,a):40==b&&v(-1,a)}function p(a){a.setAttribute("value",a.value);var b=ka(a,".saved-formula");b.dataset.rollName=a.value}function q(){return R=parseInt(fa.value,10)||0,R>=999&&(fa.value=999,R=999),R>=2&&e(ga,"hidden"),(1==R||0==R)&&d(ga,"hidden"),R}function r(){R=parseInt(fa.value,10)||0,(0>=R||""==R)&&(fa.value=1,R=1)}function s(){return Q=parseInt(ba.value,10)||0,ba.maxLength=3,Q>=999&&(ba.value=999,Q=999),Q>=1&&e(ca,"hidden"),-1>=Q&&e(ca,"hidden"),0==Q&&d(ca,"hidden"),Q}function t(){Q=parseInt(ba.value,10)||0,ba.maxLength=4,0==Q&&(ba.value="+0",Q=0),Q>0&&(ba.value="+"+Q)}function u(){Q=parseInt(ba.value,10)||0,ba.value=Q}function v(a,b){b.value=1*b.value+a,0==a&&(b.value="0")}function w(a,b,c,d){for(var e=[],f=0;a>f;f++)e.push(Math.floor(Math.random()*b)+1);var g,h=function(a){g=0;for(var b=0;b<a.length;b++)a[b]<a[g]&&(g=b);return g};h(e);var i,j=e.reduce(function(a,b){return a+b}),k=oa.dataset.active;"true"==k&&a>1?(i=e[g],e[g]='<span class="strike">'+e[g]+"</span>"):i=0;var l=j+c-i,m=e.join(", ");x(a,b,c,d,m,g,l),G()}function x(a,b,c,d,e,f,g){var h=document.createElement("div");h.setAttribute("class","result-item");var i=document.createElement("div");i.setAttribute("class","row");var j=document.createElement("div");j.setAttribute("class","col-xs-8");var k=document.createElement("div");k.setAttribute("class","col-xs-4");var l=document.createElement("p");l.setAttribute("class","breakdown");var m=document.createElement("p");m.setAttribute("class","total"),m.textContent=g,20==b&&1>=a&&(20==e?m.setAttribute("class","total critical-20"):1==e&&m.setAttribute("class","total critical-1"));var n=document.createElement("span");n.setAttribute("class","roll-name"),d&&(n.textContent=d+" ");var o=document.createElement("span");o.setAttribute("class","number-of-dice"),o.textContent=a+" ";var p=document.createElement("span");p.setAttribute("class","dice"),p.textContent="d"+b+" ";var q=document.createElement("span");q.setAttribute("class","number-of-bonus"),c>0?q.textContent="+"+c+" ":q.textContent=c+" ";var r=document.createElement("span");r.setAttribute("class","multiple-dice-results"),r.innerHTML="(Rolled: "+e+")",d&&l.appendChild(n),a>1&&l.appendChild(o),l.appendChild(p),0!=c&&l.appendChild(q),(a>1||0!=c)&&l.appendChild(r),j.appendChild(l),k.appendChild(m),i.appendChild(j),i.appendChild(k),h.appendChild(i),T.insertBefore(h,T.firstChild),G()}function y(a,b,c,d){var e=["Aieee!","Aiieee!","Arrgh!","Awk!","Awkkkkkk!","Bam!","Bang!","Bang!","Biff!","Bloop!","Blurp!","Boff!","Bonk!","Clank!","Clank!","Clash!","Clunk!","Clunk!","Crraack!","Crash!","Crraack!","Crunch!","Crunch!","Eee-yow!","Flrbbbbb!","Glipp!","Glurpp!","Kapow!","Kayo!","Ker-sploosh!","Kerplop!","Klonk!","Klunk!","Krunch!","Oooff!","Ooooff!","Ouch!","Ouch!","Owww!","Ow","Pam!","Plop!","Pow!","Powie!","Qunckkk!","Rakkk!","Rip!","Slosh!","Sock!","Splats!","Splatt!","Sploosh!","Swaap!","Swish!","Swoosh!","Thunk!","Thwack!","Thwacke!","Thwape!","Thwapp!","Uggh!","Urkkk!","Vronk!","Whack!","Whack!","Wham!","Whamm!","Whammm!","Whap!","Z-zwap!","Zam!","Zamm!","Zammm!","Zap!","Zap","Zgruppp!","Zlonk!","Zlopp!","Zlott!","Zok!","Zowie!","Zwapp!","Zzwap!","Zzzzwap!","Zzzzzwap!","Pepper-Pow!"];void 0==a&&(a=q()),void 0==b&&(b=k(W,"dice-select")),void 0==c&&(c=s()),t(),void 0==d&&(d=e[Math.floor(Math.random()*e.length)]);var f=d,g=a,h=b,i=c;1>=a&&(a=""),0==c&&(c=""),c>0&&(c="+"+c);var j=document.createElement("div");j.setAttribute("class","saved-formula"),j.dataset.rollName=f,j.dataset.dice=h,j.dataset.ammountOfDice=g,j.dataset.ammountOfBonus=i,j.dataset.eventListener=!1;var l=document.createElement("div");l.setAttribute("class","row no-gutter");var m=document.createElement("div");m.setAttribute("class","col-xs-8 col-sm-5");var n=document.createElement("div");n.setAttribute("class","col-xs-4 col-sm-3");var o=document.createElement("div");o.setAttribute("class","col-xs-2 col-sm-1");var p=document.createElement("div");p.setAttribute("class","col-xs-2 col-sm-1");var r=document.createElement("div");r.setAttribute("class","col-xs-2 col-sm-1");var u=document.createElement("div");u.setAttribute("class","col-xs-2 col-xs-offset-4 col-sm-1 col-sm-offset-0");var v=document.createElement("input");v.setAttribute("class","name"),v.setAttribute("tabindex","4"),v.setAttribute("placeholder","Name?"),v.setAttribute("type","text"),v.setAttribute("value",d);var w=document.createElement("p");w.setAttribute("class","formula");var x=document.createElement("span");x.setAttribute("class","number-of-dice"),x.textContent=a+" ";var y=document.createElement("span");y.setAttribute("class","dice"),y.textContent="d"+b+" ";var A=document.createElement("span");A.setAttribute("class","number-of-bonus"),A.textContent=c;var B=document.createElement("a");B.setAttribute("href","javascript:void(0)"),B.setAttribute("class","button button-dark button-block clear");var C=document.createElement("a");C.setAttribute("href","javascript:void(0)"),C.setAttribute("class","button button-dark button-block move-up");var D=document.createElement("a");D.setAttribute("href","javascript:void(0)"),D.setAttribute("class","button button-dark button-block move-down");var E=document.createElement("a");E.setAttribute("href","javascript:void(0)"),E.setAttribute("class","button button-primary button-block roll");var F=document.createElement("span");F.setAttribute("class","icon-close");var G=document.createElement("span");G.setAttribute("class","icon-expand-less");var H=document.createElement("span");H.setAttribute("class","icon-expand-more");var I=document.createElement("span");I.setAttribute("class","icon-chevron-right"),B.appendChild(F),C.appendChild(G),D.appendChild(H),E.appendChild(I),w.appendChild(x),w.appendChild(y),w.appendChild(A),m.appendChild(v),n.appendChild(w),o.appendChild(B),p.appendChild(C),r.appendChild(D),u.appendChild(E),l.appendChild(m),l.appendChild(n),l.appendChild(o),l.appendChild(p),l.appendChild(r),l.appendChild(u),j.appendChild(l),V.insertBefore(j,V.firstChild),z()}function z(){for(var a=b(".saved-formula"),c=b(".saved-formula .roll"),d=b(".saved-formula .move-up"),e=b(".saved-formula .move-down"),f=b(".saved-formula .clear"),h=b(".saved-formula .name"),i=0;i<a.length;i++)"false"==a[i].dataset.eventListener&&(c[i].addEventListener("click",function(){B(this),g("saved-history",T)},!1),d[i].addEventListener("click",function(){D(this),g("saved-formulas",V)},!1),e[i].addEventListener("click",function(){D(this),g("saved-formulas",V)},!1),f[i].addEventListener("click",function(){C(this),g("saved-formulas",V),G()},!1),h[i].addEventListener("input",function(){p(this),g("saved-formulas",V)},!1),h[i].addEventListener("keypress",function(){n(this)},!1),a[i].dataset.eventListener="true")}function A(){for(var a=b(".saved-formula"),c=0;c<a.length;c++)a[c].dataset.eventListener="false"}function B(a){var b=ka(a,".saved-formula"),c=b.dataset.rollName,d=parseInt(b.dataset.ammountOfDice,10),e=parseInt(b.dataset.dice,10),f=parseInt(b.dataset.ammountOfBonus,10);w(d,e,f,c)}function C(a){var b=ka(a,".saved-formula"),c=b.dataset.rollName,d=parseInt(b.dataset.ammountOfDice,10),e=parseInt(b.dataset.dice,10),f=parseInt(b.dataset.ammountOfBonus,10);b.remove(),g("saved-formulas",V);Date.now();c||(c="nameless formula"),H("Cleared "+c+".",!0,!0,d,e,f,c)}function D(a){var b=ka(a,".saved-formula"),c=ka(a,".list");if(a.classList.contains("move-up")){var h=b.previousSibling;d(b,"moving-up"),d(b.previousSibling,"moving-down");var i=function(){e(b.previousSibling,"moving-down"),e(b,"moving-up"),c.insertBefore(b,h),g("saved-formulas",V)};f(i,300)}else if(a.classList.contains("move-down")){var j=b.nextSibling.nextSibling;d(b.nextSibling,"moving-up"),d(b,"moving-down");var i=function(){e(b.nextSibling,"moving-up"),e(b,"moving-down"),c.insertBefore(b,j),g("saved-formulas",V)};f(i,300)}}function E(a){var b=a.querySelector(".text"),d=a.querySelector("span");"Expand"==b.textContent?b.textContent="Collapse":b.textContent="Expand",c(la,"bright"),c(d,"icon-unfold-more"),c(d,"icon-unfold-less"),c(S,"fullsize"),c(a,"active"),c(a,"button-primary"),c(a,"button-dark")}function F(){e(S,"active"),e(S,"fullsize"),T.innerHTML="",g("saved-history",T)}function G(){T.firstChild?S.classList.add("active"):S.classList.remove("active"),$.firstChild?U.classList.add("active"):U.classList.remove("active")}function H(b,c,g,h,i,j,k){function l(){e(y,"reveal")}function m(){y.remove()}var n=a(".snacks .snack-bars"),o=document.createElement("div");o.setAttribute("class","snack-bar"),o.setAttribute("data-roll-name",k),o.setAttribute("data-ammount-of-dice",h),o.setAttribute("data-dice",i),o.setAttribute("data-ammount-of-bonus",j);var p=document.createElement("div");p.setAttribute("class","row");var q=document.createElement("div");q.setAttribute("class","col-xs-7");var r=document.createElement("div");r.setAttribute("class","col-xs-5");var s=document.createElement("a");s.setAttribute("href","javascript:void(0)"),s.setAttribute("class","button button-dark button-small snack-clear");var t=document.createElement("a");t.setAttribute("href","javascript:void(0)"),t.setAttribute("class","button button-dark button-small snack-undo"),t.textContent="Undo";var u=document.createElement("span");u.setAttribute("class","icon-close");var v=document.createElement("p");v.setAttribute("class","snack-message"),v.textContent=b,s.appendChild(u),c&&r.appendChild(s),g&&r.appendChild(t),q.appendChild(v),p.appendChild(q),p.appendChild(r),o.appendChild(p);for(var w=n.querySelectorAll(".snack-bar"),x=0;x<w.length;x++){var y=w[x];f(l,100),f(m,400)}n.appendChild(o),I(o);var z=function(){d(o,"reveal")};f(z,10);var A=function(){o&&K(o)};f(A,5e3)}function I(a){var b=ka(a,".snack-bar"),c=b.querySelector(".snack-clear"),d=b.querySelector(".snack-undo");c&&c.addEventListener("click",function(){K(this)},!1),d&&d.addEventListener("click",function(){J(this),g("saved-formulas",V),G()},!1)}function J(a){var b=ka(a,".snack-bar"),c=b.dataset.rollName,d=parseInt(b.dataset.ammountOfDice,10),e=parseInt(b.dataset.dice,10),f=parseInt(b.dataset.ammountOfBonus,10);y(d,e,f,c),K(a)}function K(a){function b(){e(d,"reveal")}function c(){d.remove()}var d=ka(a,".snack-bar");f(b,10),f(c,500)}function L(b,c,e){function g(){d(j,"reveal"),d(i,"reveal")}var h=a("body"),i=document.createElement("div");i.setAttribute("class","prompt prompt-shade");var j=document.createElement("div");j.setAttribute("class","prompt prompt-modal");var k=document.createElement("div");k.setAttribute("class","container");var l=document.createElement("div");l.setAttribute("class","row");var m=document.createElement("div");m.setAttribute("class","row");var n=document.createElement("div");n.setAttribute("class","col-xs-12");var o=document.createElement("div");o.setAttribute("class","col-xs-6 col-lg-5");var p=document.createElement("div");p.setAttribute("class","col-xs-6 col-lg-5 col-lg-offset-2");var q=document.createElement("h1");q.setAttribute("class","prompt-heading"),q.textContent=b;var r=document.createElement("p");r.setAttribute("class","prompt-message"),r.textContent=c;var s=document.createElement("a");s.setAttribute("href","javascript:void(0)"),s.setAttribute("class","button button-primary button-block prompt-action"),s.textContent="OK";var t=document.createElement("a");t.setAttribute("href","javascript:void(0)"),t.setAttribute("class","button button-secondary button-block prompt-cancel"),t.textContent="Cancel",n.appendChild(q),n.appendChild(r),o.appendChild(t),p.appendChild(s),l.appendChild(n),m.appendChild(o),m.appendChild(p),k.appendChild(l),k.appendChild(m),j.appendChild(k),h.querySelector(".prompt.prompt-shade")||h.querySelector(".prompt.prompt-modal")||(h.appendChild(i),h.appendChild(j),f(g,10),M(e))}function M(b){var c=a(".prompt-shade"),d=(a(".prompt-modal"),a(".prompt-modal .prompt-action")),e=a(".prompt-modal .prompt-cancel");c.addEventListener("click",function(){N()}),e.addEventListener("click",function(){N()}),d.addEventListener("click",function(){"clear all"==b&&(O(),H("All cleared.",!0,!1)),"clear roll history"==b&&(F(),N(),H("Roll history cleared.",!0,!1))})}function N(){function b(){c.remove(),d.remove()}var c=a(".prompt-shade"),d=a(".prompt-modal");a(".prompt-modal .prompt-cancel");c&&d&&(c.style.opacity=0,d.style.opacity=0,f(b,500))}function O(){localStorage.clear(),T.innerHTML="",V.innerHTML="",e(S,"active"),e(S,"fullsize"),a("#d20").checked=!0,fa.value=1,ba.value=0,q(),r(),s(),t(),N()}var P,Q,R,S=(a(".controls"),a(".results")),T=a(".results .list"),U=a(".formulas"),V=a(".formulas .list"),W=a(".dice-form"),X=b(".dice-form label"),Y=a(".go-roll"),Z=a(".current-dice span"),$=a(".saved-formulas .list"),_=a(".results .toggle-fullscreen"),aa=a(".results .clear-results"),ba=(a(".controls .number-of-bonus"),a(".controls .number-of-bonus input")),ca=a(".controls .number-of-bonus .clear"),da=a(".controls .input-controls-bonus .plus-one"),ea=a(".controls .input-controls-bonus .minus-one"),fa=(a(".controls .number-of-dice"),a(".controls .number-of-dice input")),ga=a(".controls .number-of-dice .clear"),ha=a(".controls .input-controls-dice .plus-one"),ia=a(".controls .input-controls-dice .minus-one"),ja=a(".controls .save-current-formula"),ka=function(a,b){for(var c=b.charAt(0);a&&a!==document;a=a.parentNode){if("."===c&&a.classList.contains(b.substr(1)))return a;if("#"===c&&a.id===b.substr(1))return a;if("["===c&&a.hasAttribute(b.substr(1,b.length-2)))return a;if(a.tagName.toLowerCase()===b)return a}return!1},la=a("nav"),ma=a("nav .toggle-nav"),na=a("nav .clear-all"),oa=a("nav .toggle-drop-lowest"),pa=a("nav .toggle-fullscreen");ma.addEventListener("click",function(){c(la,"open")},!1),na.addEventListener("click",function(){L("Are you sure?","Roll history and saved formuals will be cleared. This can not be undone.","clear all"),e(la,"open")},!1),oa.addEventListener("click",function(){j()},!1),pa.addEventListener("click",function(){i()},!1),window.addEventListener("click",function(){e(la,"open")}),la.addEventListener("click",function(a){a.stopPropagation()}),ca.addEventListener("click",function(){v(0,ba),s(),t()},!1),ga.addEventListener("click",function(){v(0,fa),q(),r()},!1),ba.addEventListener("input",function(){s()},!1),ba.addEventListener("blur",function(){t()},!1),ba.addEventListener("focus",function(){u()},!1),ba.addEventListener("keypress",function(){n(this)},!1),ba.addEventListener("keydown",function(){o(ba),s()},!1),da.addEventListener("click",function(){v(1,ba),s(),t()},!1),ea.addEventListener("click",function(){v(-1,ba),s(),t()},!1),fa.addEventListener("input",function(){q()},!1),fa.addEventListener("blur",function(){r()},!1),fa.addEventListener("keypress",function(){n(this)},!1),fa.addEventListener("keydown",function(){o(fa),q()},!1),ha.addEventListener("click",function(){v(1,fa),q(),r()},!1),ia.addEventListener("click",function(){v(-1,fa),q(),r()},!1),Y.addEventListener("click",function(){w(q(),k(W,"dice-select"),s()),g("saved-history",T)},!1),ja.addEventListener("click",function(){y(q(),k(W,"dice-select"),s()),g("saved-formulas",V),G(),H("Formula saved.",!0,!1)},!1),_.addEventListener("click",function(){E(this)},!1),aa.addEventListener("click",function(){L("Are you sure?","Roll history will be cleared. This can not be undone.","clear roll history")},!1),s(),q(),m(),k(W,"dice-select"),l(W,"dice-select"),h("saved-formulas",V),h("saved-history",T),A(),z(),G(),t()}diceRollerama();